@page "/oggetti"

<h3 class="mb-4">Elenco Oggetti</h3>

<button type="button" class="btn btn-primary" @onclick="CaricaElencoOggetti_Click">Visualizza elenco oggetti</button>

@if (mostraTabella)
{
	<table class="table table-hover table-sm mt-4">
		<thead>
			<tr>
				<th scope="col">#</th>
				<th scope="col">Tipo</th>
				<th scope="col">Materiale principale</th>
				<th scope="col">Epoca</th>
				<th scope="col">Prezzo</th>
				<th scope="col">Stand</th>
			</tr>
		</thead>
		<tbody>
			@foreach (Oggetto item in listaOggetti)
			{
				<tr class="align-middle">
					<th scope="row">@item.idOggetto</th>
					<td>@item.tipo</td>
					<td>@(item.materialePrincipale == "" ? "Sconosciuto" : item.materialePrincipale)</td>
					<td>@(item.epoca == "" ? "Sconosciuta" : item.epoca)</td>
					<td>@item.prezzoEsposto €</td>
					<td>@item.standId</td>
				</tr>
			}
		</tbody>
	</table>
}

@code {
    List<Oggetto> listaOggetti = new List<Oggetto>();
    bool mostraTabella = false;

    private void CaricaElencoOggetti_Click()
    {
		listaOggetti.Clear();
		string connString = "Data Source=Data/dbStandAntiquariato.db;";
		SqliteConnection myConn = new SqliteConnection(connString);
		SqliteCommand myCommand = new SqliteCommand("SELECT * FROM tblOggetti;");
		SqliteDataReader myDr;
		myCommand.Connection = myConn;

		myConn.Open();

		myDr = myCommand.ExecuteReader();

		while (myDr.Read())
		{
			Oggetto x = new Oggetto
				{
					idOggetto = Convert.ToInt32(myDr["idOggetto"]),
					tipo = Convert.ToString(myDr["tipo"]),
					materialePrincipale = Convert.ToString(myDr["materialePrincipale"]),
					epoca = Convert.ToString(myDr["epoca"]),
					prezzoEsposto = Convert.ToDecimal(myDr["prezzoEsposto"]),
					standId = Convert.ToInt32(myDr["standId"])
				};
			listaOggetti.Add(x);
		}
		mostraTabella = true;

		myConn.Close();
    }
}
