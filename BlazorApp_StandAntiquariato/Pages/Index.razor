@page "/"

<h3 class="mb-4">Elenco Stand Antiquariato</h3>

<table class="table table-hover table-sm mt-4">
	<thead>
		<tr>
			<th scope="col">#</th>
			<th scope="col">Zona espositiva</th>
			<th scope="col">Superficie stand</th>
			<th scope="col">Nome</th>
			<th scope="col">Cognome</th>
			<th scope="col">Al coperto</th>
			<th scope="col">Data di inizio esposizione</th>
			<th scope="col"></th>
		</tr>
	</thead>
	<tbody>
		@foreach (Stand item in listaStand)
		{
			<tr class="align-middle">
				<th scope="row">@item.IdStand</th>
				<td>Zona @item.ZonaEsposizione</td>
				<td>@item.Superficie m<sup>2</sup></td>
				<td>@item.NomeAntiquario</td>
				<td>@item.CognomeAntiquario</td>
				<td>@(item.Coperto ? "Sì" : "No")</td>
				<td>@item.DataInizio.ToShortDateString()</td>
				<td><a href="stand/@item.IdStand" class="text-muted " title="Vedi dettagli dello stand @item.IdStand"><i class="bi bi-box-arrow-up-right"></i></a></td>
			</tr>
		}
	</tbody>
</table>

@code {
	List<Stand> listaStand = new List<Stand>();

	protected override void OnInitialized()
	{
		base.OnInitialized();
		CaricaArchivioStand_Click();
	}

	private void CaricaArchivioStand_Click()
	{
		listaStand.Clear();
		string connString = "Data Source=Data/dbStandAntiquariato.db;";
		SqliteConnection myConn = new SqliteConnection(connString);
		SqliteCommand myCommand = new SqliteCommand("SELECT * FROM tblStands;");
		SqliteDataReader myDr;
		myCommand.Connection = myConn;

		myConn.Open();

		myDr = myCommand.ExecuteReader();

		while (myDr.Read())
		{
			Stand x = new Stand
				{
					IdStand = Convert.ToInt32(myDr["IdStand"]),
					ZonaEsposizione = Convert.ToChar(myDr["ZonaEsposizione"]),
					Superficie = Convert.ToInt32(myDr["Superficie"]),
					NomeAntiquario = Convert.ToString(myDr["NomeAntiquario"]),
					CognomeAntiquario = Convert.ToString(myDr["CognomeAntiquario"]),
					Coperto = Convert.ToBoolean(myDr["Coperto"]),
					DataInizio = Convert.ToDateTime(myDr["DataInizio"])
				};
			listaStand.Add(x);
		}

		myConn.Close();
	}
}